{%- assign id = context.params.slug3 -%}
{% graphql list = 'list_read', id: id | fetch: 'models' | fetch: 'results' | first %}
{% graphql items = 'item_read', id: id | fetch: 'models' | fetch: 'results' %}

{% unless list.deleted_at %}

<h1>
  <small>{{ list.id }}</small>
  {{ list.title }}

  <form action="/list/update/{{ list.id }}" method="POST">
    <input type="text" name="title" placeholder="Change title">
    <button>save</button>
  </form>
</h1>

<hr>

<h3>Add new</h3>
<form action="/item/create/{{ list.id }}" method="POST">
  <input type="text" name="content" placeholder="Your task">
  <button>Create</button>
</form>

{% if items.size > 0 %}

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Done</th>
      <th>Content</th>
      <th>Change</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>
        {{ item.id }}
      </td>

      <td>
        <form action="/item/update/{{ item.id }}" method="POST">
          <input
            type="checkbox"
            name="completed"
            value="true"
            onchange="this.form.submit()"
            {% if item.completed == true %}checked{% endif %}
          />
          <input type="hidden" name="list_id" value="{{ list.id }}">
        </form>
        </td>
        <td>
          {{ item.content }}
        </td>
        <td>
          <form action="/item/update/{{ item.id }}" method="POST">
            <input type="text" name="content" value="{{ item.content }}" />
            <input type="hidden" name="list_id" value="{{ list.id }}">
            <button>update</button>
          </form>
        </td>

      <td>
        <form action="/item/delete/{{ item.id }}" method="POST">
          <input type="hidden" name="list_id" value="{{ list.id }}">
          <button>delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}

<br>

<p>
  Because this list is empty, you can remove it.
</p>

<form action="/list/delete/{{ list.id }}" method="POST">
  <button>Delete</button>
</form>

{% endif %}

{% else %}

This list has been deleted.

{% endunless %}
